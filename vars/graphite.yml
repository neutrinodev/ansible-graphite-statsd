---
nginx_user: "www-data"
nginx_sites:
  graphite:
    - listen 80
    - server_name {{ graphite_hostname }}
    - gzip on
    - gzip_disable msie6
    - gzip_types text/plain application/x-javascript text/xml text/css
    - location / {
        include uwsgi_params;
        uwsgi_pass 127.0.0.1:{{ uwsgi_app_port }};
      }
    - location /graphite {
        include uwsgi_params;
        uwsgi_pass 127.0.0.1:{{ uwsgi_app_port }};
      }
    - location /media  {
        alias {{ uwsgi_app_path }}/media;
      }
    - location /static {
        alias {{ uwsgi_app_path }}/static;
      }
    - location /content {
        alias /opt/graphite/webapp/graphite/content;
        include uwsgi_params;
        uwsgi_pass      127.0.0.1:{{ uwsgi_app_port }};
      }
    - location /metrics {
        alias /opt/graphite/webapp/graphite/metrics;
        include uwsgi_params;
        uwsgi_pass      127.0.0.1:{{ uwsgi_app_port }};
      }
    - location /dashboard {
        alias /opt/graphite/webapp/graphite/dashboard;
        include uwsgi_params;
        uwsgi_pass      127.0.0.1:{{ uwsgi_app_port }};
      }
    - location /render {
        alias /opt/graphite/webapp/graphite/render;
        include uwsgi_params;
        uwsgi_pass      127.0.0.1:{{ uwsgi_app_port }};
      }
    - location /browser {
        alias /opt/graphite/webapp/graphite/browser;
        include uwsgi_params;
        uwsgi_pass      127.0.0.1:{{ uwsgi_app_port }};
      }
    - location /composer {
        alias /opt/graphite/webapp/graphite/composer;
        include uwsgi_params;
        uwsgi_pass      127.0.0.1:{{ uwsgi_app_port }};
      }

nginx_configs:
  proxy:
    - proxy_set_header X-Real-IP  $remote_addr
    - proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for
  gzip:
    - gzip on
    - gzip_disable msie6
